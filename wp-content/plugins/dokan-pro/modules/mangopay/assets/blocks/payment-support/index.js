(()=>{"use strict";var e,a={5664:(e,a,t)=>{const n=window.React,r=window.wp.i18n,d="dokan_mangopay",o=window.wp.htmlEntities,s=window.wp.element,c=function(e){let a="object"==typeof e?.cards?e.cards:{};const[t,d]=(0,s.useState)(""),[o,c]=(0,s.useState)([]),[l,i]=(0,s.useState)([]);return(0,s.useEffect)((()=>{if(Object.keys(a).length){let t=Object.keys(a).map((e=>({key:e,value:a[e]}))),n=t.filter((a=>e.validateItem(a)));d(n.length?n[0].key:""),i(n),c(t)}}),[]),(0,s.useEffect)((()=>{e.onChange(t)}),[t]),(0,n.createElement)("div",{className:"dokan-mangopay-credit-cards"},Object.keys(a).length?(()=>{let a=[];return o.forEach((t=>{e.validateItem(t)&&a.push((0,n.createElement)("option",{key:t.key,value:t.key},t.value))})),a.length||a.push((0,n.createElement)("option",{key:"no_card_found",value:""},(0,r.__)("Select a card","dokan"))),(0,n.createElement)("select",{className:"dokan-mangopay-credit-cards-content",name:"dokan_mangopay_card_type",value:t,onChange:e=>d(e.target.value)},a)})():(0,r.__)("No cards found","dokan"))},l=window.wp.apiFetch;var i=t.n(l);const{Label:g,ValidatedTextInput:m,Button:u,Spinner:p}=window.wc.blocksComponents,_=e=>{var a,t;const o=window.wc.wcSettings.getSetting(`${d}_data`),l=window.mangoPay,[p,_]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[k,b]=(0,s.useState)(""),[h,E]=(0,s.useState)(""),[w,f]=(0,s.useState)(""),[C,S]=(0,s.useState)([]),[N,R]=(0,s.useState)([]),[I,O]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{var e,a;let t;t=Object.keys(null!==(e=o?.months)&&void 0!==e?e:{}).map((e=>({value:e,label:o?.months[e]}))),t[0]&&f(t[0].value),R(t),t=Object.keys(null!==(a=o?.years)&&void 0!==a?a:{}).map((e=>({value:e,label:o?.years[e]}))),t[0]&&E(t[0].value),S(t)}),[]),(0,n.createElement)("div",{className:"dokan-mangopay-add-card-box"},(0,n.createElement)(g,{label:(0,r.__)("Card Type","dokan")}),(0,n.createElement)(c,{id:"choose-card-type",cards:null!==(a=o?.available_card_types)&&void 0!==a?a:{},selectedCards:null!==(t=o?.selected_debit_cards)&&void 0!==t?t:{},validateItem:e=>"BANK_WIRE"!==e.key&&"IDEAL"!==e.key&&o?.selected_credit_cards.includes(e.key),onChange:e=>_(e)}),(0,n.createElement)(m,{id:"dokan-register-card-number",errorId:"dokan-register-card-number",className:"",label:(0,r.__)("Card Number","dokan"),type:"text",value:y,onChange:e=>{v(e)},focusOnMount:!1,validateOnMount:!1}),(0,n.createElement)(m,{id:"dokan-register-card-cvv",errorId:"dokan-register-card-cvv",className:"",label:(0,r.__)("CVV","dokan"),type:"text",value:k,onChange:e=>{b(e)},focusOnMount:!1,validateOnMount:!1}),(0,n.createElement)("div",{className:"dokan-mangopay-add-card-box-divider"}),(0,n.createElement)(g,{label:(0,r.__)("Expiration Date","dokan")}),(0,n.createElement)("div",{className:"dokan-mangopay-expire-select"},(0,n.createElement)("select",{className:"dokan-mangopay-expire-month",value:w,onChange:e=>f(e.target.value)},N.map((e=>(0,n.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,n.createElement)("span",null,"/"),(0,n.createElement)("select",{className:"dokan-mangopay-expire-year",value:h,onChange:e=>E(e.target.value)},C.map((e=>(0,n.createElement)("option",{key:e.value,value:e.value},e.label))))),(0,n.createElement)("div",{className:"dokan-mangopay-add-card-box-divider"}),(0,n.createElement)("div",{className:"dokan-mangopay-add-card-box-button"},(0,n.createElement)(u,{disabled:I,onClick:()=>{if(void 0===o?.userId||""===o?.userId||!o?.userId)return;const a={user_id:o?.userId,card_type:p};let t=w;1==String(w).length&&(t=`0${String(w)}`);const n=`${t}${String(h)}`,r={cardNumber:String(y),cardExpirationDate:n,cardCvx:String(k),cardType:p};p&&w&&h&&r.cardNumber&&r.cardCvx&&(O(!0),i()({data:a,path:"/dokan/v1/mangopay/block/registered/cards",method:"POST"}).then((a=>{if(a?.CardRegistrationId){const{CardRegistrationId:t,CardRegistrationURL:n,PreregistrationData:d,AccessKey:s}=a;((a,t,n,r,d)=>{l.cardRegistration.baseURL=o.mangopay_url,l.cardRegistration.clientId=o.client_id,l.cardRegistration.init({cardRegistrationURL:t,preregistrationData:n,accessKey:r,Id:a}),l.cardRegistration.registerCard(d,(function(a){a.cardRegId&&a.cardRegData?((a,t)=>{const n={card_id:a,reg_data:t};i()({data:n,path:"/dokan/v1/mangopay/block/registered/cards",method:"PUT"}).finally((()=>{O(!1),e.refreshCards()}))})(a.cardRegId,a.cardRegData):(O(!1),e.refreshCards())}),(function(a){console.error(a),O(!1),e.refreshCards()}))})(t,n,d,s,r)}})).catch((e=>{O(!1)})))}},I?(0,n.createElement)("span",null,(0,r.__)("Registering…","dokan")):(0,n.createElement)("span",null,(0,r.__)("Register","dokan"))),(0,n.createElement)(u,{disabled:I,onClick:()=>e.onClose()},(0,r.__)("Cancel","dokan"))))},y=e=>{let a=e?.cards,t=e?.selected,d=e?.setSelectedCard;const{RadioControl:o,Button:c}=window.wc.blocksComponents,[l,i]=(0,s.useState)([]),[g,m]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{if(Array.isArray(a)&&a.length){let t=a.map((a=>({label:(0,n.createElement)(n.Fragment,null,a.Alias," ",(0,n.createElement)("div",{className:"dashicons dashicons-trash",onClick:()=>e.deleteCard(a.Id)})),value:a.Id})));i(t)}}),[]),(0,n.createElement)("div",{className:"dokan-mangopay-registered-cards-box"},Array.isArray(a)&&a.length?(0,n.createElement)(o,{className:"",onChange:e=>{d(e)},disabled:!1,selected:t,options:l}):(0,n.createElement)("div",{className:"dokan-mangopay-registered-cards-box-empty"},(0,n.createElement)("p",{className:"dokan-mangopay-registered-cards-box-empty-message"},(0,r.__)("You have not registered a card yet. You can add one below.","dokan"))),(0,n.createElement)("div",{className:"dokan-mangopay-add-new-box"},g?(0,n.createElement)(_,{refreshCards:()=>e.refreshCards(),onClose:()=>m(!1)}):(0,n.createElement)(c,{onClick:()=>m(!g)},(0,r.__)("+ Add New","dokan"))))},{Spinner:v}=window.wc.blocksComponents,k=()=>(0,n.createElement)("div",{className:"dokan-mangopay-registered-cards-loader"},(0,n.createElement)(v,null),(0,n.createElement)("span",{className:"dokan-mangopay-registered-cards-loader-label"},(0,r.__)("Processing...","dokan"))),b=function(e){const[a,t]=(0,s.useState)(!0),[r,d]=(0,s.useState)([]),[o,c]=(0,s.useState)(""),l=async()=>{t(!0);try{const e=await i()({path:"/dokan/v1/mangopay/block/registered/cards"});if("object"==typeof e&&Object.values(e).length){let a=Object.values(e);d(a),g(a[a.length-1].Id)}else d([]),g("")}catch(e){console.error("Error fetching registered cards:",e)}finally{t(!1)}},g=a=>{c(a),e.onChange(a)};return(0,s.useEffect)((()=>{l()}),[]),(0,n.createElement)("div",{className:"mangopay-registered-cards"},a?(0,n.createElement)(k,null):(0,n.createElement)(y,{deleteCard:e=>(e=>{t(!0),i()({path:"/dokan/v1/mangopay/block/registered/cards",method:"DELETE",data:{card_id:e}}).finally((()=>{l()}))})(e),refreshCards:()=>l(),cards:r,selected:o,setSelectedCard:g}))},h=window.wc.blocksComponents.RadioControlAccordion,E=function(e){var a;const[t,d]=(0,s.useState)(""),[o,l]=(0,s.useState)([]),[i,g]=(0,s.useState)(""),[m,u]=(0,s.useState)(""),[p,_]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[k,E]=(0,s.useState)(""),[w,f]=(0,s.useState)(""),[C,S]=(0,s.useState)(""),[N,R]=(0,s.useState)(""),[I,O]=(0,s.useState)(""),x=null!==(a=e?.settings)&&void 0!==a?a:{},{eventRegistration:A,emitResponse:P}=e,{onPaymentSetup:j,onPaymentProcessing:D}=A,T=e=>{"bank_wire"===e&&O("")},M=e=>"BANK_WIRE"!==e.key&&x?.selected_credit_cards.includes(e.key),B=e=>x?.selected_debit_cards.includes(e.key),L=e=>{O(e)};(0,s.useEffect)((()=>{g("yes"),u(window.navigator.language),_(window.screen.colorDepth),v(window.screen.height),E(window.screen.width),f((new Date).getTimezoneOffset().toString()),S(window.navigator.userAgent),R(window.navigator.javaEnabled()?"yes":"no"),(()=>{let e="";const a=[...o],t=Array.isArray(x?.selected_credit_cards)?x.selected_credit_cards:[];if(x?.credit_card_activated&&x?.credit_card_enabled){var s,i;const t="card",d={value:t,label:x?.credit_card_enabled?(0,r.__)("Credit Card","dokan"):(0,r.__)("Credit Card Type","dokan"),onChange:T,name:"dokan_mangopay_payment_type_credit_card",content:(0,n.createElement)(c,{cards:null!==(s=x?.available_card_types)&&void 0!==s?s:{},selectedCards:null!==(i=x?.selected_credit_cards)&&void 0!==i?i:{},validateItem:M,onChange:L})};e=String(e).length?e:t,a.push(d)}if(x?.debit_card_enabled&&(x?.credit_card_enabled||t.includes("BANK_WIRE"))){var g,m;const d="directdebitweb",o={value:d,label:x?.credit_card_enabled||t.includes("BANK_WIRE")?(0,r.__)("Direct Debit Web Wire","dokan"):(0,r.__)("Payment Type","dokan"),onChange:T,name:"dokan_mangopay_payment_type_debit_card",content:(0,n.createElement)(c,{cards:null!==(g=x?.available_direct_payments)&&void 0!==g?g:{},selectedCards:null!==(m=x?.selected_debit_cards)&&void 0!==m?m:{},validateItem:B,onChange:L})};e=String(e).length?e:d,a.push(o)}if(t.includes("BANK_WIRE")&&(x?.credit_card_activated||x?.debit_card_enabled)){const t="bank_wire",d={value:t,label:(0,r.__)("Direct Bank Wire","dokan"),onChange:T,name:"dokan_mangopay_payment_type_bank_wire",content:(0,n.createElement)(n.Fragment,null)};e=String(e).length?e:t,a.push(d)}if(x?.saved_cards_enabled&&x?.mangopay_account_id&&String(x.mangopay_account_id).length){const t="registeredcard",d={value:t,label:(0,r.__)("Registered Card","dokan"),onChange:T,name:"dokan_mangopay_payment_type_registeredcard",content:(0,n.createElement)(b,{onChange:L})};e=String(e).length?e:t,a.push(d)}d(e),l(a)})()}),[]);const W=()=>{const e={dokan_mangopay_payment_type:t,"dokan-mangopay-3ds2-java":String(N),"dokan-mangopay-3ds2-js":String(i),"dokan-mangopay-3ds2-lang":String(m),"dokan-mangopay-3ds2-color-depth":String(p),"dokan-mangopay-3ds2-screen-height":String(y),"dokan-mangopay-3ds2-screen-width":String(k),"dokan-mangopay-3ds2-timezone-offset":String(w),"dokan-mangopay-3ds2-user-agent":String(C)};let a="";return"card"===t?e.dokan_mangopay_card_type=I:"directdebitweb"===t?e.dokan_mangopay_directdebitweb_type=I:"registeredcard"===t&&(e.registered_card_selected=I,I||(a=(0,r.__)("Could not create the MangoPay payment. Please select a registered card or add one.","dokan"))),a?{type:P.responseTypes.ERROR,message:a}:{type:P.responseTypes.SUCCESS,meta:{paymentMethodData:e}}};return(0,s.useEffect)((()=>{const e=j(W);return()=>e()}),[t,I]),(0,n.createElement)("div",{className:"mangopay-block-description"},(0,n.createElement)(h,{instanceId:Date.now(),className:"mangopay-radio-block",id:"dokan_mangopay_payment_type",onChange:e=>{d(e)},options:o,selected:t}))};var w;const{registerPaymentMethod:f}=window.wc.wcBlocksRegistry,C=wc.wcSettings.getSetting(`${d}_data`),S=null!==(w=C?.title)&&void 0!==w?w:(0,o.decodeEntities)((0,r.__)("MangoPay","dokan"));f({name:d,label:(0,n.createElement)((function(e){var a,t;const{PaymentMethodLabel:r}=e.components,d=null!==(a=e?.settings)&&void 0!==a?a:{};let o=d?.icon?(0,n.createElement)("img",{src:d.icon}):null!==(t=e.label)&&void 0!==t?t:"";return(0,n.createElement)(r,{text:o})}),{label:S,settings:C}),content:(0,n.createElement)(E,{settings:C}),edit:(0,n.createElement)(E,{settings:C}),canMakePayment:()=>!0,ariaLabel:S,supports:{}})}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var d=t[e]={exports:{}};return a[e](d,d.exports,n),d.exports}n.m=a,e=[],n.O=(a,t,r,d)=>{if(!t){var o=1/0;for(i=0;i<e.length;i++){for(var[t,r,d]=e[i],s=!0,c=0;c<t.length;c++)(!1&d||o>=d)&&Object.keys(n.O).every((e=>n.O[e](t[c])))?t.splice(c--,1):(s=!1,d<o&&(o=d));if(s){e.splice(i--,1);var l=r();void 0!==l&&(a=l)}}return a}d=d||0;for(var i=e.length;i>0&&e[i-1][2]>d;i--)e[i]=e[i-1];e[i]=[t,r,d]},n.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return n.d(a,{a}),a},n.d=(e,a)=>{for(var t in a)n.o(a,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},n.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={8190:0,2034:0};n.O.j=a=>0===e[a];var a=(a,t)=>{var r,d,[o,s,c]=t,l=0;if(o.some((a=>0!==e[a]))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(c)var i=c(n)}for(a&&a(t);l<o.length;l++)d=o[l],n.o(e,d)&&e[d]&&e[d][0](),e[d]=0;return n.O(i)},t=globalThis.webpackChunkdokan_pro=globalThis.webpackChunkdokan_pro||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))})();var r=n.O(void 0,[2034],(()=>n(5664)));r=n.O(r)})();